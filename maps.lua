
function load_map(m)
	MAP = m

	for y = 1, #MAP, 1 do
		for x = 1, #MAP[y] do
			if MAP[y][x] == 1 then
				table.insert(SHADOWS, newShadow({uid=newUID(),x=(x-1)*16+8,y=(y-1)*16+8}))
				table.insert(SOLIDS, newGround({uid=newUID(),x=(x-1)*16,y=(y-1)*16}))
			elseif MAP[y][x] == 2 then
				table.insert(ENTITIES, newEye({uid=newUID(),x=(x-1)*16,y=(y-1)*16}))
			elseif MAP[y][x] == 3 then
				table.insert(ENTITIES, newSpikes({uid=newUID(),x=(x-1)*16,y=(y-1)*16,direction=DIR_UP}))
			elseif MAP[y][x] == 4 then
				table.insert(ENTITIES, newSpikes({uid=newUID(),x=(x-1)*16,y=(y-1)*16,direction=DIR_DOWN}))
			elseif MAP[y][x] == 5 then
				table.insert(ENTITIES, newSpikes({uid=newUID(),x=(x-1)*16,y=(y-1)*16,direction=DIR_RIGHT}))
			elseif MAP[y][x] == 6 then
				table.insert(ENTITIES, newSpikes({uid=newUID(),x=(x-1)*16,y=(y-1)*16,direction=DIR_LEFT}))
			elseif MAP[y][x] == 7 then
				table.insert(ENTITIES, newBouncer({uid=newUID(),x=(x-1)*16,y=(y-1)*16}))
			elseif MAP[y][x] == 8 then
				table.insert(SHADOWS, newShadow({uid=newUID(),x=(x-1)*16,y=(y-1)*16}))
				table.insert(SOLIDS, newBridge({uid=newUID(),x=(x-1)*16,y=(y-1)*16}))
			elseif MAP[y][x] == 9 then
				table.insert(ENTITIES, newGem({uid=newUID(),x=(x-1)*16,y=(y-1)*16}))
			elseif MAP[y][x] == 10 then
				table.insert(ENTITIES, newHeady({uid=newUID(),x=(x-1)*16,y=(y-1)*16}))
			elseif MAP[y][x] == 11 then
				table.insert(SOLIDS, newLog({uid=newUID(),x=(x-1)*16,y=(y-1)*16}))
			end
		end
	end

	table.insert(EFFECTS, newCounter({}))
end

MAP_plain = {
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,},
}

MAP_log = {
	{1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{0,0,0,0,0,0,0,0,9,9,9,9,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,11,0,0,0,0,0,0,0,11,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,11,0,0,0,10,0,0,0,11,0,0,0,0,0,0,0,},
	{1,1,1,1,0,0,0,0,1,1,1,1,0,0,0,0,1,1,1,1,},
}

MAP_castle0 = {
	{1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,0,1,1,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,9,9,9,9,0,0,0,0,0,0,9,9,9,9,0,0,0,},
	{0,0,0,9,9,9,9,0,0,0,0,0,0,9,9,9,9,0,0,0,},
	{0,0,0,8,8,8,8,0,0,0,0,0,0,8,8,8,8,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,0,0,},
	{1,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,0,1,1,1,},
}

MAP_castle1 = {
	{1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,9,9,0,0,0,0,0,9,9,9,9,0,0,0,0,0,0,0,1,},
	{1,8,8,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,8,8,8,1,1,1,1,0,0,9,9,0,0,0,1,},
	{1,0,0,0,0,0,0,0,1,1,1,1,8,8,8,8,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,2,0,0,9,9,9,0,0,0,0,0,9,9,9,0,0,0,10,1,},
	{1,8,8,8,8,8,8,0,0,0,0,0,8,8,8,8,8,8,8,1,},
	{1,0,0,0,0,0,0,0,0,9,9,9,0,0,0,0,0,0,0,1,},
	{1,10,9,9,0,0,0,0,0,9,9,9,0,0,0,0,0,0,2,1,},
	{1,8,8,8,8,0,0,0,8,8,8,8,8,0,0,0,0,8,8,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,},
}

MAP_castle2 = {
	{1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,9,9,0,0,0,0,0,9,9,9,9,0,0,0,0,0,0,0,1,},
	{1,8,8,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,8,8,8,1,9,9,1,0,0,9,9,0,0,0,1,},
	{0,0,0,0,0,0,0,0,1,9,9,1,8,8,8,8,0,0,0,0,},
	{0,0,0,0,0,0,0,0,1,9,9,1,0,0,0,0,0,0,0,0,},
	{0,2,0,0,9,9,9,0,1,9,9,1,9,9,9,0,0,0,2,0,},
	{1,8,8,8,8,8,8,0,1,8,8,1,8,8,8,8,8,8,8,1,},
	{1,0,0,0,0,0,0,0,9,9,9,9,0,0,0,0,0,0,0,1,},
	{1,10,9,9,0,0,0,0,9,9,9,9,0,0,0,0,0,0,10,1,},
	{1,8,8,8,8,0,0,0,8,8,8,8,8,0,0,0,0,8,8,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,1,1,1,1,1,1,1,0,0,0,0,1,1,1,1,1,1,1,1,},
}

MAP_castle3 = {
	{1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,},
	{1,0,0,0,0,1,0,0,0,0,10,0,0,0,1,0,0,0,0,1,},
	{1,0,0,0,0,1,0,9,9,9,9,9,9,0,1,0,0,0,0,1,},
	{1,2,0,0,0,1,0,8,8,8,8,8,8,0,1,0,0,0,2,1,},
	{1,9,9,0,0,1,0,0,0,0,0,0,0,0,1,0,0,9,9,1,},
	{1,9,9,0,0,1,0,0,0,0,0,0,0,0,1,0,0,9,9,1,},
	{1,1,1,0,0,1,8,8,8,0,0,8,8,8,1,0,0,1,1,1,},
	{1,1,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,1,1,},
	{1,0,0,0,0,0,0,0,9,9,9,9,0,0,0,0,0,0,0,1,},
	{1,0,0,9,9,0,0,0,1,1,1,1,0,0,9,9,0,0,0,1,},
	{1,0,0,9,9,0,0,0,1,1,1,1,0,0,9,9,0,0,0,1,},
	{1,0,0,8,8,8,8,8,1,1,1,1,8,8,8,8,8,8,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,1,1,},
}

MAP_castle4 = {
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,},
	{1,0,9,9,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,},
	{1,9,9,9,9,0,0,0,0,0,0,1,0,9,9,9,9,9,0,1,},
	{1,9,9,9,9,0,0,0,0,0,0,1,0,9,9,9,9,9,0,1,},
	{1,0,9,9,0,0,0,0,0,0,0,1,0,0,0,0,2,0,0,1,},
	{1,1,1,1,1,1,0,0,0,0,0,1,8,8,8,8,8,8,8,1,},
	{1,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,10,0,0,0,0,0,0,0,0,10,0,0,0,0,0,0,0,0,1,},
	{1,8,8,8,8,8,8,8,1,1,1,1,8,8,8,8,8,8,8,1,},
	{0,0,0,0,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,0,},
	{0,0,0,9,9,0,0,0,1,1,1,1,0,0,0,9,9,0,0,0,},
	{0,0,0,9,9,0,0,0,1,1,1,1,0,0,0,9,9,0,0,0,},
	{1,0,0,7,0,0,0,0,1,1,1,1,0,0,0,0,0,0,0,1,},
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,},
}

MAP_castle5 = {
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,},
	{1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,},
	{1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,9,9,9,9,9,9,9,9,9,9,0,0,0,0,1,},
	{0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,},
	{0,0,0,0,0,9,9,9,9,9,9,9,9,9,9,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{8,8,8,1,0,0,0,0,0,0,0,0,0,0,0,0,1,8,8,8,},
	{0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,},
	{0,0,0,1,3,3,3,3,3,3,3,3,3,3,3,3,1,0,0,0,},
	{0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,},
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,},
}

MAP_castle6 = {
	{1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,9,9,9,1,9,9,9,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,9,9,9,1,9,9,9,0,0,0,0,0,0,0,0,0,0,},
	{0,0,2,9,9,9,1,9,9,9,2,0,0,0,0,0,0,0,0,0,},
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,1,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,},
	{1,0,0,0,0,9,9,9,0,0,0,0,0,0,0,0,0,0,1,1,},
	{1,0,0,0,0,9,9,9,0,0,0,0,0,0,0,1,1,1,1,1,},
	{0,0,0,9,9,0,0,0,9,9,0,0,0,0,1,1,1,0,0,0,},
	{0,0,0,9,9,0,0,0,9,9,0,0,0,1,1,1,1,0,0,0,},
	{1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,},
}

MAP_castle7 = {
	{1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,0,1,1,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{0,0,0,9,9,9,9,0,0,0,0,0,0,9,9,9,9,0,0,0,},
	{0,0,0,9,9,9,9,0,0,0,0,0,0,9,9,9,9,0,0,0,},
	{0,0,0,8,8,8,8,0,0,0,0,0,0,8,8,8,8,0,0,0,},
	{0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,},
	{2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,2,0,},
	{1,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,9,9,9,9,9,9,9,9,0,0,0,0,0,1,},
	{1,0,0,0,0,0,8,8,8,8,8,8,8,8,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,},
	{1,1,1,0,0,0,1,1,1,1,1,1,1,1,0,0,0,1,1,1,},
}

MAP_test = {
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,},
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,},
	{1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,1,},
	{1,0,0,2,0,0,0,0,0,1,1,0,0,0,0,0,2,0,0,1,},
	{1,8,8,8,8,8,8,8,8,1,1,8,8,8,8,8,8,8,8,1,},
	{0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,},
	{0,0,0,0,2,0,0,0,0,1,1,9,0,0,0,0,0,2,0,0,},
	{1,8,8,8,1,8,8,8,8,1,1,8,8,8,8,1,1,1,1,1,},
	{1,0,0,0,1,0,0,0,0,1,1,0,0,0,0,1,0,0,0,1,},
	{1,0,0,0,1,0,0,2,0,1,1,0,0,0,2,1,0,0,0,1,},
	{1,8,8,8,1,8,8,8,8,1,1,8,8,8,8,1,8,8,8,1,},
	{1,0,0,0,1,0,0,0,0,1,1,0,0,0,0,1,0,0,0,1,},
	{1,0,0,0,1,0,0,0,0,0,2,0,0,0,0,1,0,0,0,1,},
	{1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,8,8,8,1,},
}

STAGES = {
	--MAP_test,
	MAP_log,
	MAP_castle0,
	MAP_castle1,
	MAP_castle2,
	MAP_castle3,
	MAP_castle4,
	MAP_castle5,
	MAP_castle6,
	MAP_castle7,
}
